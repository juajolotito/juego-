<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Respira y Rel√°jate</title>
<style>
  body {
    margin: 0;
    background: linear-gradient(180deg, #87CEEB, #4ec0ca);
    font-family: Arial, sans-serif;
    overflow: hidden;
    color: #fff;
  }

  #gameCanvas {
    display: block;
    margin: auto;
    background: #4ec0ca;
  }

  #guide {
    position: fixed;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: rgba(255,255,255,0.5);
    transition: all 4s ease-in-out;
  }

  #infoPanel {
    position: fixed;
    top: 10px;
    left: 10px;
    background: rgba(0,0,0,0.4);
    padding: 10px;
    border-radius: 10px;
    font-size: 18px;
    text-align: left;
  }

  #instructions {
    position: fixed;
    top: 10px;
    right: 10px;
    background: rgba(0,0,0,0.4);
    padding: 10px;
    border-radius: 10px;
    font-size: 16px;
    width: 250px;
    line-height: 1.4;
  }
</style>
</head>
<body>
<canvas id="gameCanvas" width="400" height="600"></canvas>

<!-- Indicadores -->
<div id="guide"></div>
<div id="infoPanel">
  üå¨Ô∏è Espiraciones: <span id="exhales">0</span><br>
  ‚è±Ô∏è Tiempo: <span id="time">0:00</span><br>
  üéØ Precisi√≥n: <span id="accuracy">100%</span><br>
  üíì Ritmo: <span id="rhythm">--</span>
</div>

<div id="instructions">
  <strong>Respira y Rel√°jate</strong><br>
  Sigue el c√≠rculo de respiraci√≥n:<br>
  ‚úÖ Inhala cuando crece (4s)<br>
  ‚úÖ Mant√©n cuando est√° grande (4s)<br>
  ‚úÖ Exhala cuando se encoge (6s)<br>
  üíÜ‚Äç‚ôÄÔ∏è T√©cnica 4-4-6 para relajaci√≥n
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let bird = { x: 80, y: 300, size: 20, velocity: 0, gravity: 0.6, lift: -1.2 };
let inhaling = false;
let lastPressTime = null;
let score = 0;
let obstacles = [];
let frameCount = 0;

// M√©tricas
let exhalesCount = 0;
let startTime = Date.now();
let accuracy = 100;
let rhythm = "--";

// Gu√≠a visual
const guide = document.getElementById("guide");
function breathingGuide() {
  // Inhala (4s)
  guide.style.transition = "all 4s ease-in-out";
  guide.style.width = "200px";
  guide.style.height = "200px";
  document.getElementById("rhythm").innerText = "Inhala";

  setTimeout(() => {
    // Mant√©n (4s)
    document.getElementById("rhythm").innerText = "Mant√©n";
  }, 4000);

  setTimeout(() => {
    // Exhala (6s)
    guide.style.transition = "all 6s ease-in-out";
    guide.style.width = "100px";
    guide.style.height = "100px";
    document.getElementById("rhythm").innerText = "Exhala";
  }, 8000);

  setTimeout(breathingGuide, 14000); // ciclo completo 14s
}
breathingGuide();

// Controles
document.addEventListener("keydown", (e) => {
  if (e.code === "Space" && !inhaling) {
    inhaling = true;
    lastPressTime = Date.now();
  }
});

document.addEventListener("keyup", (e) => {
  if (e.code === "Space" && inhaling) {
    inhaling = false;
    let duration = (Date.now() - lastPressTime) / 1000;

    // Calcular precisi√≥n seg√∫n t√©cnica 4-4-6
    if (duration >= 3 && duration <= 5) {
      score += 10;
    } else {
      score -= 5;
    }
    exhalesCount++;
    document.getElementById("exhales").innerText = exhalesCount;
  }
});

// Obst√°culos
function createObstacle() {
  const height = Math.floor(Math.random() * 200) + 100;
  const gap = 150;
  obstacles.push({ x: canvas.width, y: height, width: 50, gap: gap });
}

function drawObstacles() {
  ctx.fillStyle = "#2E8B57";
  obstacles.forEach((obs) => {
    ctx.fillRect(obs.x, 0, obs.width, obs.y); // parte superior
    ctx.fillRect(obs.x, obs.y + obs.gap, obs.width, canvas.height); // parte inferior
  });
}

function updateObstacles() {
  obstacles.forEach((obs) => {
    obs.x -= 2; // velocidad
  });
  obstacles = obstacles.filter((obs) => obs.x + obs.width > 0);
  if (frameCount % 150 === 0) createObstacle();
}

// Actualizar tiempo y precisi√≥n
function updateMetrics() {
  let elapsed = Math.floor((Date.now() - startTime) / 1000);
  let mins = Math.floor(elapsed / 60);
  let secs = elapsed % 60;
  document.getElementById("time").innerText = `${mins}:${secs < 10 ? "0" : ""}${secs}`;
  document.getElementById("accuracy").innerText = accuracy + "%";
}

// Juego
function update() {
  if (inhaling) bird.velocity += bird.lift;
  bird.velocity += bird.gravity;
  bird.y += bird.velocity;

  if (bird.y > canvas.height - bird.size) {
    bird.y = canvas.height - bird.size;
    bird.velocity = 0;
  }
  if (bird.y < 0) {
    bird.y = 0;
    bird.velocity = 0;
  }

  updateObstacles();
  updateMetrics();
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Bird
  ctx.fillStyle = "#FFD700";
  ctx.beginPath();
  ctx.arc(bird.x, bird.y, bird.size, 0, Math.PI * 2);
  ctx.fill();

  drawObstacles();
}

function gameLoop() {
  frameCount++;
  update();
  draw();
  requestAnimationFrame(gameLoop);
}
gameLoop();
</script>
</body>
</html>
